---
import { ChevronLeft, ChevronRight } from "@lucide/astro";
import { getCollection, render } from "astro:content";
import { Layout } from "../../layouts";
import { TopNavigationLesson } from "../../components";

export async function getStaticPaths() {
  const allDocu = await getCollection("docu");

  return allDocu.map((doc) => {
    return {
      params: {
        id: doc.data.url,
      },
      props: {
        doc,
        numberOfLessons: allDocu.length,
      },
    };
  });
}

const { doc, numberOfLessons } = Astro.props;
const { number, title, nextUrl, previousUrl } = doc.data;

const { Content } = await render(doc);

const getUrl = (url?: string) => (url ? `/docu/${url}` : null);
const nextUrlPath = getUrl(nextUrl);
const previousUrlPath = getUrl(previousUrl);

const hasPrevious = Boolean(previousUrlPath);
const hasNext = Boolean(nextUrlPath);
---

<Layout>
  <div
    class="sticky top-16 z-40 w-full border-b border-border/40 bg-card/95 backdrop-blur supports-backdrop-filter:bg-card/60"
  >
    <div class="container mx-auto px-4 h-16 flex items-center justify-between">
      <div class="flex-1">
        <TopNavigationLesson
          url={previousUrlPath}
          label="Anterior"
          iconDirection="left"
        />
      </div>

      <div class="flex-1 text-center">
        <div class="text-sm text-muted-foreground">
          Lección {number} de {numberOfLessons}
        </div>
        <div class="font-semibold text-sm">{title}</div>
      </div>

      <div class="flex-1 flex justify-end">
        <TopNavigationLesson
          url={nextUrlPath}
          label="Siguiente"
          iconDirection="right"
        />
      </div>
    </div>
  </div>

  <main class="container mx-auto px-4 py-12 max-w-4xl">
    <div class="bg-card border border-border rounded-2xl p-8 md:p-12 shadow-lg">
      <article class="prose prose-lg dark:prose-invert max-w-none">
        <Content />
      </article>
    </div>

    <div class="flex items-center justify-between mt-8">
      <a href={hasPrevious ? previousUrlPath : "/"}>
        <button
          class="inline-flex items-center gap-2 bg-transparent px-6 py-4 rounded-xl font-semibold cursor-pointer"
        >
          <ChevronLeft class="w-4 h-4" />
          {hasPrevious ? "Lección Anterior" : "Volver al Inicio"}
        </button>
      </a>

      <a href={hasNext ? nextUrlPath : "/"}>
        <button
          class="inline-flex items-center gap-2 bg-linear-to-r from-primary to-accent text-primary-foreground px-6 py-4 rounded-xl font-semibold cursor-pointer"
        >
          {hasNext ? "Siguiente Lección" : "Completar Curso"}
          <ChevronRight class="w-4 h-4" />
        </button>
      </a>
    </div>
  </main>
</Layout>
